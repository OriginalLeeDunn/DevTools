<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unit Converter</title>
  <!-- Include TailwindCSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#10B981', // green-500
          }
        }
      }
    }
  </script>
  <style>
    .converter-group {
      opacity: 0;
      transform: translateY(10px);
      animation: fadeIn 0.3s forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto py-6 px-4 max-w-4xl">
    <!-- Header -->
    <div class="mb-6">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Unit Converter</h1>
          <p class="text-gray-600">Convert between different units of measurement</p>
        </div>
        <a href="../dashboard/index.html" class="mt-4 md:mt-0 px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-600 transition">
          Back to Dashboard
        </a>
      </div>
    </div>
    
    <!-- Unit Converter Main Content -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <!-- Category Navigation -->
      <div class="flex flex-wrap gap-2 mb-6">
        <button id="lengthBtn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-600 transition">Length</button>
        <button id="areaBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Area</button>
        <button id="volumeBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Volume</button>
        <button id="weightBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Weight</button>
        <button id="temperatureBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Temperature</button>
        <button id="timeBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Time</button>
        <button id="dataBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Data</button>
        <button id="speedBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Speed</button>
      </div>
      
      <!-- Converter Section -->
      <div id="converterContainer">
        <!-- Will be populated dynamically based on selected category -->
        <div id="lengthConverter" class="converter-group">
          <h2 class="text-xl font-bold mb-4 text-gray-800">Length Conversion</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Input -->
            <div>
              <label for="lengthInput" class="block text-sm font-medium text-gray-700 mb-1">From</label>
              <div class="flex">
                <input type="number" id="lengthInput" class="block w-full rounded-l-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20" value="1">
                <select id="lengthFromUnit" class="rounded-r-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20">
                  <option value="m">Meters (m)</option>
                  <option value="km">Kilometers (km)</option>
                  <option value="cm">Centimeters (cm)</option>
                  <option value="mm">Millimeters (mm)</option>
                  <option value="in">Inches (in)</option>
                  <option value="ft">Feet (ft)</option>
                  <option value="yd">Yards (yd)</option>
                  <option value="mi">Miles (mi)</option>
                </select>
              </div>
            </div>
            <!-- Output -->
            <div>
              <label for="lengthOutput" class="block text-sm font-medium text-gray-700 mb-1">To</label>
              <div class="flex">
                <input type="text" id="lengthOutput" class="block w-full rounded-l-md bg-gray-50 border-gray-300 shadow-sm" readonly>
                <select id="lengthToUnit" class="rounded-r-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20">
                  <option value="m">Meters (m)</option>
                  <option value="km">Kilometers (km)</option>
                  <option value="cm">Centimeters (cm)</option>
                  <option value="mm">Millimeters (mm)</option>
                  <option value="in">Inches (in)</option>
                  <option value="ft" selected>Feet (ft)</option>
                  <option value="yd">Yards (yd)</option>
                  <option value="mi">Miles (mi)</option>
                </select>
              </div>
            </div>
          </div>
          <!-- Conversion Formula -->
          <div class="mt-6 p-3 bg-gray-50 rounded-md">
            <h3 class="text-sm font-medium text-gray-700">Conversion Formula</h3>
            <p id="lengthFormula" class="text-sm text-gray-600 mt-1">1 meter = 3.28084 feet</p>
          </div>
        </div>
      </div>
      
      <!-- Common Conversions -->
      <div class="mt-8">
        <h2 class="text-lg font-bold mb-3 text-gray-800">Common Conversions</h2>
        <div id="commonConversions" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3">
          <!-- Will be populated dynamically -->
        </div>
      </div>
      
      <!-- Recent Conversions -->
      <div class="mt-8">
        <h2 class="text-lg font-bold mb-3 text-gray-800">Recent Conversions</h2>
        <div id="recentConversions" class="space-y-2">
          <div class="text-gray-500 text-center py-2">No recent conversions</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const categoryButtons = {
      length: document.getElementById('lengthBtn'),
      area: document.getElementById('areaBtn'),
      volume: document.getElementById('volumeBtn'),
      weight: document.getElementById('weightBtn'),
      temperature: document.getElementById('temperatureBtn'),
      time: document.getElementById('timeBtn'),
      data: document.getElementById('dataBtn'),
      speed: document.getElementById('speedBtn')
    };
    
    const converterContainer = document.getElementById('converterContainer');
    const commonConversions = document.getElementById('commonConversions');
    const recentConversions = document.getElementById('recentConversions');
    
    // Length converter elements
    const lengthInput = document.getElementById('lengthInput');
    const lengthFromUnit = document.getElementById('lengthFromUnit');
    const lengthToUnit = document.getElementById('lengthToUnit');
    const lengthOutput = document.getElementById('lengthOutput');
    const lengthFormula = document.getElementById('lengthFormula');
    
    // Unit conversion factors (relative to base unit)
    const unitFactors = {
      length: {
        m: 1,         // meter (base unit)
        km: 1000,     // kilometer
        cm: 0.01,     // centimeter
        mm: 0.001,    // millimeter
        in: 0.0254,   // inch
        ft: 0.3048,   // foot
        yd: 0.9144,   // yard
        mi: 1609.34   // mile
      },
      area: {
        m2: 1,            // square meter (base unit)
        km2: 1000000,     // square kilometer
        cm2: 0.0001,      // square centimeter
        mm2: 0.000001,    // square millimeter
        ha: 10000,        // hectare
        acre: 4046.86,    // acre
        ft2: 0.092903,    // square foot
        in2: 0.00064516   // square inch
      },
      volume: {
        m3: 1,              // cubic meter (base unit)
        l: 0.001,           // liter
        ml: 0.000001,       // milliliter
        gal_us: 0.00378541, // US gallon
        qt_us: 0.000946353, // US quart
        pt_us: 0.000473176, // US pint
        fl_oz_us: 0.0000295735, // US fluid ounce
        ft3: 0.0283168,     // cubic foot
        in3: 0.0000163871   // cubic inch
      },
      weight: {
        kg: 1,          // kilogram (base unit)
        g: 0.001,       // gram
        mg: 0.000001,   // milligram
        t: 1000,        // metric ton
        lb: 0.453592,   // pound
        oz: 0.0283495,  // ounce
        st: 6.35029     // stone
      },
      temperature: {
        // Special case, handled separately
      },
      time: {
        s: 1,            // second (base unit)
        min: 60,         // minute
        h: 3600,         // hour
        day: 86400,      // day
        week: 604800,    // week
        month: 2629800,  // month (average)
        year: 31557600   // year (365.25 days)
      },
      data: {
        B: 1,                 // byte (base unit)
        KB: 1024,             // kilobyte
        MB: Math.pow(1024, 2), // megabyte
        GB: Math.pow(1024, 3), // gigabyte
        TB: Math.pow(1024, 4), // terabyte
        PB: Math.pow(1024, 5)  // petabyte
      },
      speed: {
        mps: 1,         // meters per second (base unit)
        kph: 0.277778,  // kilometers per hour
        mph: 0.44704,   // miles per hour
        fps: 0.3048,    // feet per second
        knot: 0.514444  // knot
      }
    };
    
    // Unit display names
    const unitNames = {
      length: {
        m: "Meters (m)",
        km: "Kilometers (km)",
        cm: "Centimeters (cm)",
        mm: "Millimeters (mm)",
        in: "Inches (in)",
        ft: "Feet (ft)",
        yd: "Yards (yd)",
        mi: "Miles (mi)"
      },
      area: {
        m2: "Square Meters (m²)",
        km2: "Square Kilometers (km²)",
        cm2: "Square Centimeters (cm²)",
        mm2: "Square Millimeters (mm²)",
        ha: "Hectares (ha)",
        acre: "Acres",
        ft2: "Square Feet (ft²)",
        in2: "Square Inches (in²)"
      },
      volume: {
        m3: "Cubic Meters (m³)",
        l: "Liters (L)",
        ml: "Milliliters (mL)",
        gal_us: "US Gallons",
        qt_us: "US Quarts",
        pt_us: "US Pints",
        fl_oz_us: "US Fluid Ounces",
        ft3: "Cubic Feet (ft³)",
        in3: "Cubic Inches (in³)"
      },
      weight: {
        kg: "Kilograms (kg)",
        g: "Grams (g)",
        mg: "Milligrams (mg)",
        t: "Metric Tons (t)",
        lb: "Pounds (lb)",
        oz: "Ounces (oz)",
        st: "Stones (st)"
      },
      temperature: {
        c: "Celsius (°C)",
        f: "Fahrenheit (°F)",
        k: "Kelvin (K)"
      },
      time: {
        s: "Seconds (s)",
        min: "Minutes (min)",
        h: "Hours (h)",
        day: "Days",
        week: "Weeks",
        month: "Months",
        year: "Years"
      },
      data: {
        B: "Bytes (B)",
        KB: "Kilobytes (KB)",
        MB: "Megabytes (MB)",
        GB: "Gigabytes (GB)",
        TB: "Terabytes (TB)",
        PB: "Petabytes (PB)"
      },
      speed: {
        mps: "Meters per Second (m/s)",
        kph: "Kilometers per Hour (km/h)",
        mph: "Miles per Hour (mph)",
        fps: "Feet per Second (ft/s)",
        knot: "Knots"
      }
    };
    
    // Common conversions for each category
    const commonConversionsData = {
      length: [
        { from: 'ft', to: 'm', value: 1 },
        { from: 'in', to: 'cm', value: 1 },
        { from: 'mi', to: 'km', value: 1 },
        { from: 'm', to: 'yd', value: 1 }
      ],
      area: [
        { from: 'm2', to: 'ft2', value: 1 },
        { from: 'km2', to: 'mi2', value: 1 },
        { from: 'ha', to: 'acre', value: 1 }
      ],
      volume: [
        { from: 'l', to: 'gal_us', value: 1 },
        { from: 'ml', to: 'fl_oz_us', value: 1 },
        { from: 'm3', to: 'ft3', value: 1 }
      ],
      weight: [
        { from: 'kg', to: 'lb', value: 1 },
        { from: 'g', to: 'oz', value: 1 },
        { from: 't', to: 'lb', value: 1 }
      ],
      temperature: [
        { from: 'c', to: 'f', value: 0 },
        { from: 'c', to: 'k', value: 0 },
        { from: 'f', to: 'c', value: 32 }
      ],
      time: [
        { from: 'day', to: 'h', value: 1 },
        { from: 'week', to: 'day', value: 1 },
        { from: 'min', to: 's', value: 1 }
      ],
      data: [
        { from: 'GB', to: 'MB', value: 1 },
        { from: 'MB', to: 'KB', value: 1 },
        { from: 'TB', to: 'GB', value: 1 }
      ],
      speed: [
        { from: 'mph', to: 'kph', value: 1 },
        { from: 'mps', to: 'kph', value: 1 },
        { from: 'knot', to: 'mph', value: 1 }
      ]
    };
    
    // Current category and recent conversion history
    let currentCategory = 'length';
    let recentConversionsHistory = [];
    
    // Load recent conversions from localStorage
    function loadRecentConversions() {
      const savedConversions = localStorage.getItem('recentConversions');
      if (savedConversions) {
        recentConversionsHistory = JSON.parse(savedConversions).slice(0, 10); // Keep only the last 10
        renderRecentConversions();
      }
    }
    
    // Save recent conversions to localStorage
    function saveRecentConversions() {
      localStorage.setItem('recentConversions', JSON.stringify(recentConversionsHistory.slice(0, 10)));
    }
    
    // Add a conversion to the history
    function addToRecentConversions(from, fromUnit, to, toUnit, category) {
      // Check if a similar conversion already exists and remove it
      recentConversionsHistory = recentConversionsHistory.filter(conv => 
        !(conv.fromUnit === fromUnit && conv.toUnit === toUnit && conv.category === category)
      );
      
      // Add the new conversion to the beginning of the array
      recentConversionsHistory.unshift({
        from: parseFloat(from),
        fromUnit,
        to: parseFloat(to),
        toUnit,
        category,
        timestamp: new Date().getTime()
      });
      
      // Save and render
      saveRecentConversions();
      renderRecentConversions();
    }
    
    // Render recent conversions
    function renderRecentConversions() {
      if (recentConversionsHistory.length === 0) {
        recentConversions.innerHTML = '<div class="text-gray-500 text-center py-2">No recent conversions</div>';
        return;
      }
      
      recentConversions.innerHTML = '';
      
      recentConversionsHistory.forEach(conv => {
        const convItem = document.createElement('div');
        convItem.className = 'p-3 bg-gray-50 rounded-lg flex flex-col sm:flex-row sm:items-center sm:justify-between';
        
        // Format the values
        const fromValue = formatValue(conv.from);
        const toValue = formatValue(conv.to);
        
        // Get unit display names
        const fromUnitName = unitNames[conv.category]?.[conv.fromUnit] || conv.fromUnit;
        const toUnitName = unitNames[conv.category]?.[conv.toUnit] || conv.toUnit;
        
        convItem.innerHTML = `
          <div class="mb-2 sm:mb-0">
            <span class="font-medium">${fromValue} ${fromUnitName.split(' ')[0]}</span>
            <span class="text-gray-500 mx-2">=</span>
            <span class="font-medium">${toValue} ${toUnitName.split(' ')[0]}</span>
          </div>
          <div>
            <span class="text-xs text-gray-500">${getCategoryName(conv.category)}</span>
            <button class="ml-4 text-sm text-primary hover:text-green-700 use-conversion-btn"
                    data-from="${conv.from}"
                    data-from-unit="${conv.fromUnit}"
                    data-to-unit="${conv.toUnit}"
                    data-category="${conv.category}">
              Use Again
            </button>
          </div>
        `;
        
        recentConversions.appendChild(convItem);
      });
      
      // Add event listeners to "Use Again" buttons
      document.querySelectorAll('.use-conversion-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const category = btn.dataset.category;
          const fromUnit = btn.dataset.fromUnit;
          const toUnit = btn.dataset.toUnit;
          const fromValue = btn.dataset.from;
          
          // Switch to the selected category
          selectCategory(category);
          
          // Set the values in the converter
          setTimeout(() => {
            const input = document.getElementById(`${category}Input`);
            const fromUnitSelect = document.getElementById(`${category}FromUnit`);
            const toUnitSelect = document.getElementById(`${category}ToUnit`);
            
            if (input && fromUnitSelect && toUnitSelect) {
              input.value = fromValue;
              fromUnitSelect.value = fromUnit;
              toUnitSelect.value = toUnit;
              
              // Trigger conversion
              performConversion(category);
            }
          }, 100); // Small delay to ensure the converter is rendered
        });
      });
    }
    
    // Get category display name
    function getCategoryName(category) {
      const names = {
        length: "Length",
        area: "Area",
        volume: "Volume",
        weight: "Weight",
        temperature: "Temperature",
        time: "Time",
        data: "Data Size",
        speed: "Speed"
      };
      return names[category] || category;
    }
    
    // Render common conversions for the current category
    function renderCommonConversions() {
      commonConversions.innerHTML = '';
      
      const conversions = commonConversionsData[currentCategory] || [];
      
      conversions.forEach(conv => {
        const convertedValue = convertValue(conv.value, conv.from, conv.to, currentCategory);
        
        // Format the values
        const fromValue = formatValue(conv.value);
        const toValue = formatValue(convertedValue);
        
        // Get unit display names
        const fromUnitName = unitNames[currentCategory]?.[conv.from] || conv.from;
        const toUnitName = unitNames[currentCategory]?.[conv.to] || conv.to;
        
        const commonConvItem = document.createElement('div');
        commonConvItem.className = 'p-3 bg-gray-50 rounded-lg';
        commonConvItem.innerHTML = `
          <div class="font-medium">${fromValue} ${fromUnitName.split(' ')[0]} = ${toValue} ${toUnitName.split(' ')[0]}</div>
          <div class="text-xs text-gray-500 mt-1">${fromUnitName} to ${toUnitName}</div>
        `;
        
        commonConversions.appendChild(commonConvItem);
      });
    }
    
    // Create a new converter for the given category
    function createConverter(category) {
      // Get units for the selected category
      const units = unitNames[category] || {};
      
      // Create HTML for the converter
      const converterHtml = `
        <div id="${category}Converter" class="converter-group">
          <h2 class="text-xl font-bold mb-4 text-gray-800">${getCategoryName(category)} Conversion</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Input -->
            <div>
              <label for="${category}Input" class="block text-sm font-medium text-gray-700 mb-1">From</label>
              <div class="flex">
                <input type="number" id="${category}Input" class="block w-full rounded-l-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20" value="1">
                <select id="${category}FromUnit" class="rounded-r-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20">
                  ${Object.entries(units).map(([unit, name]) => `<option value="${unit}">${name}</option>`).join('')}
                </select>
              </div>
            </div>
            <!-- Output -->
            <div>
              <label for="${category}Output" class="block text-sm font-medium text-gray-700 mb-1">To</label>
              <div class="flex">
                <input type="text" id="${category}Output" class="block w-full rounded-l-md bg-gray-50 border-gray-300 shadow-sm" readonly>
                <select id="${category}ToUnit" class="rounded-r-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20">
                  ${Object.entries(units).map(([unit, name], i) => 
                    `<option value="${unit}" ${i === 1 ? 'selected' : ''}>${name}</option>`
                  ).join('')}
                </select>
              </div>
            </div>
          </div>
          <!-- Conversion Formula -->
          <div class="mt-6 p-3 bg-gray-50 rounded-md">
            <h3 class="text-sm font-medium text-gray-700">Conversion Formula</h3>
            <p id="${category}Formula" class="text-sm text-gray-600 mt-1"></p>
          </div>
        </div>
      `;
      
      return converterHtml;
    }
    
    // Select a category
    function selectCategory(category) {
      // Update current category
      currentCategory = category;
      
      // Update button styles
      Object.keys(categoryButtons).forEach(cat => {
        if (cat === category) {
          categoryButtons[cat].classList.remove('bg-gray-200', 'text-gray-700');
          categoryButtons[cat].classList.add('bg-primary', 'text-white');
        } else {
          categoryButtons[cat].classList.add('bg-gray-200', 'text-gray-700');
          categoryButtons[cat].classList.remove('bg-primary', 'text-white');
        }
      });
      
      // Check if converter exists for this category
      let converter = document.getElementById(`${category}Converter`);
      
      if (!converter) {
        // Create new converter
        converterContainer.innerHTML = createConverter(category);
        
        // Add event listeners to the new converter
        const input = document.getElementById(`${category}Input`);
        const fromUnit = document.getElementById(`${category}FromUnit`);
        const toUnit = document.getElementById(`${category}ToUnit`);
        
        if (input && fromUnit && toUnit) {
          [input, fromUnit, toUnit].forEach(el => {
            el.addEventListener('input', () => performConversion(category));
            el.addEventListener('change', () => performConversion(category));
          });
        }
      } else {
        // Show the existing converter
        document.querySelectorAll('.converter-group').forEach(conv => {
          if (conv.id === `${category}Converter`) {
            conv.classList.remove('hidden');
          } else {
            conv.classList.add('hidden');
          }
        });
      }
      
      // Update common conversions
      renderCommonConversions();
      
      // Perform initial conversion
      performConversion(category);
    }
    
    // Format value for display
    function formatValue(value) {
      // Handle very small or very large numbers
      if (Math.abs(value) < 0.000001 || Math.abs(value) > 1000000) {
        return Number(value).toExponential(6);
      }
      
      // Handle regular numbers
      return Number(parseFloat(value).toFixed(6)).toString();
    }
    
    // Convert value between units for the given category
    function convertValue(value, fromUnit, toUnit, category) {
      // Special handling for temperature
      if (category === 'temperature') {
        return convertTemperature(value, fromUnit, toUnit);
      }
      
      // Get conversion factors
      const factors = unitFactors[category];
      if (!factors) return value;
      
      // Convert to base unit first, then to target unit
      const valueInBaseUnit = value * factors[fromUnit];
      return valueInBaseUnit / factors[toUnit];
    }
    
    // Special handling for temperature conversion
    function convertTemperature(value, fromUnit, toUnit) {
      // Convert to Kelvin first (as the base unit)
      let kelvin;
      
      if (fromUnit === 'c') {
        kelvin = parseFloat(value) + 273.15;
      } else if (fromUnit === 'f') {
        kelvin = (parseFloat(value) - 32) * 5/9 + 273.15;
      } else {
        kelvin = parseFloat(value);
      }
      
      // Convert from Kelvin to the target unit
      if (toUnit === 'c') {
        return kelvin - 273.15;
      } else if (toUnit === 'f') {
        return (kelvin - 273.15) * 9/5 + 32;
      } else {
        return kelvin;
      }
    }
    
    // Update the formula display
    function updateFormula(fromUnit, toUnit, category) {
      const formulaElement = document.getElementById(`${category}Formula`);
      if (!formulaElement) return;
      
      let formula = '';
      
      if (category === 'temperature') {
        // Special formulas for temperature
        if (fromUnit === 'c' && toUnit === 'f') {
          formula = '°F = (°C × 9/5) + 32';
        } else if (fromUnit === 'f' && toUnit === 'c') {
          formula = '°C = (°F - 32) × 5/9';
        } else if (fromUnit === 'c' && toUnit === 'k') {
          formula = 'K = °C + 273.15';
        } else if (fromUnit === 'k' && toUnit === 'c') {
          formula = '°C = K - 273.15';
        } else if (fromUnit === 'f' && toUnit === 'k') {
          formula = 'K = (°F - 32) × 5/9 + 273.15';
        } else if (fromUnit === 'k' && toUnit === 'f') {
          formula = '°F = (K - 273.15) × 9/5 + 32';
        }
      } else {
        // For other units, show the conversion factor
        const factors = unitFactors[category];
        if (factors) {
          const fromValue = factors[fromUnit];
          const toValue = factors[toUnit];
          
          if (fromValue && toValue) {
            const conversionFactor = toValue / fromValue;
            const inverseConversionFactor = fromValue / toValue;
            
            // Get unit display names (without the units in parentheses)
            const fromName = unitNames[category]?.[fromUnit]?.split(' ')[0] || fromUnit;
            const toName = unitNames[category]?.[toUnit]?.split(' ')[0] || toUnit;
            
            if (conversionFactor === 1) {
              formula = `1 ${fromName} = 1 ${toName}`;
            } else if (conversionFactor < 0.000001 || conversionFactor > 1000000) {
              formula = `1 ${fromName} = ${conversionFactor.toExponential(6)} ${toName}`;
              formula += `<br>1 ${toName} = ${inverseConversionFactor.toExponential(6)} ${fromName}`;
            } else {
              formula = `1 ${fromName} = ${conversionFactor.toLocaleString(undefined, { maximumFractionDigits: 6 })} ${toName}`;
              formula += `<br>1 ${toName} = ${inverseConversionFactor.toLocaleString(undefined, { maximumFractionDigits: 6 })} ${fromName}`;
            }
          }
        }
      }
      
      formulaElement.innerHTML = formula;
    }
    
    // Perform conversion for the given category
    function performConversion(category) {
      const input = document.getElementById(`${category}Input`);
      const output = document.getElementById(`${category}Output`);
      const fromUnit = document.getElementById(`${category}FromUnit`);
      const toUnit = document.getElementById(`${category}ToUnit`);
      
      if (!input || !output || !fromUnit || !toUnit) return;
      
      const value = parseFloat(input.value);
      
      if (isNaN(value)) {
        output.value = '';
        return;
      }
      
      // Get the converted value
      const convertedValue = convertValue(value, fromUnit.value, toUnit.value, category);
      
      // Format and display the result
      if (Math.abs(convertedValue) < 0.000001 || Math.abs(convertedValue) > 1000000) {
        output.value = convertedValue.toExponential(6);
      } else {
        output.value = convertedValue.toLocaleString(undefined, { maximumFractionDigits: 6 });
      }
      
      // Update the formula display
      updateFormula(fromUnit.value, toUnit.value, category);
      
      // Add to recent conversions
      addToRecentConversions(input.value, fromUnit.value, convertedValue, toUnit.value, category);
    }
    
    // Initialize the app
    function init() {
      // Set up event listeners for category buttons
      Object.keys(categoryButtons).forEach(category => {
        categoryButtons[category].addEventListener('click', () => {
          selectCategory(category);
        });
      });
      
      // Set up event listeners for the length converter (initial category)
      lengthInput.addEventListener('input', () => performConversion('length'));
      lengthFromUnit.addEventListener('change', () => performConversion('length'));
      lengthToUnit.addEventListener('change', () => performConversion('length'));
      
      // Load recent conversions from localStorage
      loadRecentConversions();
      
      // Initialize with length category
      selectCategory('length');
    }
    
    // Start the app
    init();
  </script>
</body>
</html>
