<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Snippet Manager</title>
  <!-- Include TailwindCSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Include Prism.js for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-java.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-html.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-sql.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5',
          }
        }
      },
      darkMode: 'class'
    }
  </script>
  <style>
    .snippet-list-item:hover .delete-btn {
      opacity: 1;
    }
    .delete-btn {
      opacity: 0;
      transition: opacity 0.2s ease;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <div class="w-64 bg-white shadow-md flex flex-col">
      <!-- Header -->
      <div class="bg-primary text-white p-4">
        <div class="flex flex-col">
          <h1 class="text-xl font-bold">Code Snippet Manager</h1>
          <a href="../dashboard/index.html" class="text-indigo-200 text-sm mt-1 hover:text-white">‚Üê Back to Dashboard</a>
        </div>
      </div>
      
      <!-- Search Bar -->
      <div class="p-4 border-b">
        <div class="relative">
          <input type="text" id="searchInput" placeholder="Search snippets..." class="w-full px-3 py-2 pl-9 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-2 top-2.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
      </div>
      
      <!-- Tags Filter -->
      <div class="p-4 border-b">
        <h2 class="text-sm font-medium text-gray-500 uppercase mb-2">Filter by Tag</h2>
        <div class="flex flex-wrap gap-1" id="tagFilters">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
      
      <!-- Snippet List -->
      <div class="flex-grow overflow-y-auto p-4" id="snippetList">
        <!-- Will be populated by JavaScript -->
        <div class="text-center text-gray-500 mt-8">
          No snippets yet. Create your first one!
        </div>
      </div>
      
      <!-- Add New Snippet Button -->
      <div class="p-4 border-t">
        <button id="newSnippetBtn" class="w-full bg-primary hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          New Snippet
        </button>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="flex-grow flex flex-col">
      <!-- Editor Header -->
      <div class="bg-white p-4 flex justify-between items-center shadow-sm">
        <div class="flex-grow">
          <input type="text" id="snippetTitle" placeholder="Snippet title..." class="w-full text-xl font-bold border-0 focus:outline-none focus:ring-0">
        </div>
        <div class="space-x-2">
          <button id="copyBtn" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-100 transition flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            Copy
          </button>
          <button id="saveBtn" class="px-3 py-1 bg-primary text-white rounded hover:bg-indigo-700 transition flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Save
          </button>
        </div>
      </div>
      
      <!-- Code Editor Controls -->
      <div class="bg-white border-y p-3 flex justify-between items-center">
        <div class="flex items-center space-x-3">
          <div>
            <label for="languageSelect" class="text-sm font-medium text-gray-700">Language:</label>
            <select id="languageSelect" class="border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-primary">
              <option value="javascript">JavaScript</option>
              <option value="html">HTML</option>
              <option value="css">CSS</option>
              <option value="python">Python</option>
              <option value="java">Java</option>
              <option value="sql">SQL</option>
              <option value="plaintext">Plain Text</option>
            </select>
          </div>
          <div>
            <label for="snippetTags" class="text-sm font-medium text-gray-700">Tags:</label>
            <input type="text" id="snippetTags" placeholder="tag1, tag2, tag3" class="border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
        </div>
        <div>
          <button id="previewBtn" class="px-3 py-1 border border-gray-300 rounded-l hover:bg-gray-100 transition">Edit</button>
          <button id="editBtn" class="px-3 py-1 border border-gray-300 rounded-r bg-gray-100 hover:bg-gray-100 transition">Preview</button>
        </div>
      </div>
      
      <!-- Code Editor/Preview Area -->
      <div class="flex-grow bg-gray-800 overflow-hidden relative">
        <textarea id="codeEditor" class="w-full h-full p-4 bg-gray-800 text-gray-200 font-mono absolute inset-0 resize-none focus:outline-none" spellcheck="false"></textarea>
        
        <div id="previewArea" class="w-full h-full p-4 overflow-auto hidden">
          <pre><code id="codePreview" class="language-javascript"></code></pre>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
      <h3 class="text-xl font-bold mb-4">Delete Snippet</h3>
      <p class="mb-6">Are you sure you want to delete this snippet? This action cannot be undone.</p>
      <div class="flex justify-end space-x-3">
        <button id="cancelDeleteBtn" class="px-4 py-2 border rounded hover:bg-gray-100 transition">Cancel</button>
        <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">Delete</button>
      </div>
    </div>
  </div>

  <script>
    // Snippet object structure
    class Snippet {
      constructor(id, title, code, language, tags, createdAt) {
        this.id = id || Date.now().toString();
        this.title = title || 'Untitled Snippet';
        this.code = code || '';
        this.language = language || 'javascript';
        this.tags = tags || [];
        this.createdAt = createdAt || new Date().toISOString();
      }
    }

    // DOM Elements
    const searchInput = document.getElementById('searchInput');
    const tagFilters = document.getElementById('tagFilters');
    const snippetList = document.getElementById('snippetList');
    const newSnippetBtn = document.getElementById('newSnippetBtn');
    const snippetTitle = document.getElementById('snippetTitle');
    const languageSelect = document.getElementById('languageSelect');
    const snippetTags = document.getElementById('snippetTags');
    const codeEditor = document.getElementById('codeEditor');
    const previewBtn = document.getElementById('previewBtn');
    const editBtn = document.getElementById('editBtn');
    const previewArea = document.getElementById('previewArea');
    const codePreview = document.getElementById('codePreview');
    const copyBtn = document.getElementById('copyBtn');
    const saveBtn = document.getElementById('saveBtn');
    const deleteModal = document.getElementById('deleteModal');
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

    // State
    let snippets = [];
    let currentSnippet = null;
    let activeTagFilter = null;
    let snippetToDelete = null;

    // Load snippets from localStorage
    function loadSnippets() {
      const savedSnippets = localStorage.getItem('codeSnippets');
      if (savedSnippets) {
        snippets = JSON.parse(savedSnippets);
      } else {
        // Add some example snippets if none exist
        snippets = [
          new Snippet(
            '1',
            'Fetch API Example',
            `// Example of using the Fetch API
fetch('https://api.example.com/data')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(data => {
    console.log(data);
  })
  .catch(error => {
    console.error('Error fetching data:', error);
  });`,
            'javascript',
            ['javascript', 'api', 'fetch']
          ),
          new Snippet(
            '2',
            'Basic HTML Template',
            `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Hello World</h1>
  </header>
  <main>
    <p>This is a basic HTML template.</p>
  </main>
  <script src="script.js"></script>
</body>
</html>`,
            'html',
            ['html', 'template']
          )
        ];
        saveSnippets();
      }
    }

    // Save snippets to localStorage
    function saveSnippets() {
      localStorage.setItem('codeSnippets', JSON.stringify(snippets));
    }

    // Clear the editor and prepare for a new snippet
    function newSnippet() {
      currentSnippet = new Snippet();
      snippetTitle.value = '';
      codeEditor.value = '';
      snippetTags.value = '';
      languageSelect.value = 'javascript';
      updatePreview();
      
      // Switch to edit mode
      previewBtn.classList.add('bg-gray-100');
      editBtn.classList.remove('bg-gray-100');
      codeEditor.classList.remove('hidden');
      previewArea.classList.add('hidden');
      
      // Focus on the title
      snippetTitle.focus();
    }

    // Display a snippet in the editor
    function displaySnippet(snippet) {
      currentSnippet = snippet;
      snippetTitle.value = snippet.title;
      codeEditor.value = snippet.code;
      snippetTags.value = snippet.tags.join(', ');
      languageSelect.value = snippet.language;
      updatePreview();
    }

    // Update the code preview with syntax highlighting
    function updatePreview() {
      const code = codeEditor.value;
      const language = languageSelect.value;

      codePreview.className = `language-${language}`;
      codePreview.textContent = code;

      // Apply syntax highlighting
      Prism.highlightElement(codePreview);
    }

    // Save the current snippet
    function saveSnippet() {
      if (!currentSnippet) return;
      
      const title = snippetTitle.value || 'Untitled Snippet';
      const code = codeEditor.value;
      const language = languageSelect.value;
      const tagsInput = snippetTags.value;
      
      // Parse tags from comma-separated string
      const tags = tagsInput
        .split(',')
        .map(tag => tag.trim())
        .filter(tag => tag !== '');
      
      // Update the current snippet
      currentSnippet.title = title;
      currentSnippet.code = code;
      currentSnippet.language = language;
      currentSnippet.tags = tags;
      
      // Find the existing snippet in the array or add a new one
      const existingIndex = snippets.findIndex(s => s.id === currentSnippet.id);
      if (existingIndex !== -1) {
        snippets[existingIndex] = currentSnippet;
      } else {
        snippets.push(currentSnippet);
      }
      
      // Save to localStorage and refresh the UI
      saveSnippets();
      renderSnippetList();
      renderTagFilters();
      
      // Show feedback to the user
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        Saved!
      `;
      
      setTimeout(() => {
        saveBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Save
        `;
      }, 1500);
    }

    // Delete a snippet
    function deleteSnippet() {
      if (!snippetToDelete) return;
      
      // Remove the snippet from the array
      snippets = snippets.filter(s => s.id !== snippetToDelete);
      
      // Save to localStorage and refresh the UI
      saveSnippets();
      renderSnippetList();
      renderTagFilters();
      
      // Hide modal
      deleteModal.classList.add('hidden');
      
      // If the deleted snippet was the one being edited, create a new snippet
      if (currentSnippet && currentSnippet.id === snippetToDelete) {
        newSnippet();
      }
      
      // Reset the snippetToDelete
      snippetToDelete = null;
    }

    // Copy the current snippet to clipboard
    function copyToClipboard() {
      const code = codeEditor.value;
      navigator.clipboard.writeText(code)
        .then(() => {
          // Show feedback to the user
          const copyBtn = document.getElementById('copyBtn');
          copyBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Copied!
          `;
          
          setTimeout(() => {
            copyBtn.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              Copy
            `;
          }, 1500);
        })
        .catch(err => {
          console.error('Failed to copy: ', err);
        });
    }

    // Filter snippets by search term or tag
    function filterSnippets() {
      const searchTerm = searchInput.value.toLowerCase();
      
      let filteredSnippets = snippets.filter(snippet => {
        // If there's an active tag filter, filter by that tag
        if (activeTagFilter && !snippet.tags.includes(activeTagFilter)) {
          return false;
        }
        
        // Filter by search term in title or code
        if (searchTerm) {
          return snippet.title.toLowerCase().includes(searchTerm) || 
                 snippet.code.toLowerCase().includes(searchTerm);
        }
        
        return true;
      });
      
      // Sort by date (newest first)
      filteredSnippets.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      
      renderSnippetList(filteredSnippets);
    }

    // Render the list of snippets
    function renderSnippetList(filteredSnippets = null) {
      const snippetsToRender = filteredSnippets || snippets;
      
      if (snippetsToRender.length === 0) {
        snippetList.innerHTML = '<div class="text-center text-gray-500 mt-8">No snippets found.</div>';
        return;
      }
      
      snippetList.innerHTML = '';
      
      snippetsToRender.forEach(snippet => {
        const snippetEl = document.createElement('div');
        snippetEl.className = 'snippet-list-item mb-3 p-3 bg-white rounded-lg shadow-sm hover:bg-gray-50 cursor-pointer transition relative';
        
        // Format date
        const date = new Date(snippet.createdAt);
        const dateString = date.toLocaleDateString();
        
        // Create tag pills
        const tagPills = snippet.tags.map(tag => 
          `<span class="inline-block text-xs bg-gray-100 text-gray-600 rounded-full px-2 py-0.5">${tag}</span>`
        ).join(' ');
        
        snippetEl.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h3 class="font-medium text-gray-800">${snippet.title}</h3>
              <div class="text-xs text-gray-500 mt-1">${dateString}</div>
              <div class="flex flex-wrap gap-1 mt-2">${tagPills}</div>
            </div>
            <button class="delete-btn text-gray-400 hover:text-red-500" data-id="${snippet.id}">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        `;
        
        // Add click event to open the snippet
        snippetEl.addEventListener('click', (e) => {
          if (!e.target.closest('.delete-btn')) {
            displaySnippet(snippet);
          }
        });
        
        snippetList.appendChild(snippetEl);
      });
      
      // Add delete buttons event listeners
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const id = btn.getAttribute('data-id');
          snippetToDelete = id;
          deleteModal.classList.remove('hidden');
        });
      });
    }

    // Render tag filters
    function renderTagFilters() {
      // Get all unique tags from snippets
      const allTags = new Set();
      snippets.forEach(snippet => {
        snippet.tags.forEach(tag => allTags.add(tag));
      });
      
      // Sort tags alphabetically
      const sortedTags = Array.from(allTags).sort();
      
      tagFilters.innerHTML = `
        <button class="bg-gray-100 hover:bg-gray-200 rounded-full px-3 py-1 text-xs font-medium text-gray-700 transition ${!activeTagFilter ? 'bg-primary text-white hover:bg-primary' : ''}" data-tag="">
          All
        </button>
      `;
      
      sortedTags.forEach(tag => {
        const tagBtn = document.createElement('button');
        tagBtn.className = `bg-gray-100 hover:bg-gray-200 rounded-full px-3 py-1 text-xs font-medium text-gray-700 transition ${activeTagFilter === tag ? 'bg-primary text-white hover:bg-primary' : ''}`;
        tagBtn.setAttribute('data-tag', tag);
        tagBtn.textContent = tag;
        
        tagFilters.appendChild(tagBtn);
      });
      
      // Add event listeners to tag filter buttons
      document.querySelectorAll('#tagFilters button').forEach(btn => {
        btn.addEventListener('click', () => {
          const tag = btn.getAttribute('data-tag');
          activeTagFilter = tag || null;
          
          // Update active button style
          document.querySelectorAll('#tagFilters button').forEach(b => {
            if (b.getAttribute('data-tag') === activeTagFilter) {
              b.classList.add('bg-primary', 'text-white', 'hover:bg-primary');
              b.classList.remove('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
            } else {
              b.classList.remove('bg-primary', 'text-white', 'hover:bg-primary');
              b.classList.add('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
            }
          });
          
          filterSnippets();
        });
      });
    }

    // Event listeners
    newSnippetBtn.addEventListener('click', newSnippet);
    saveBtn.addEventListener('click', saveSnippet);
    copyBtn.addEventListener('click', copyToClipboard);
    searchInput.addEventListener('input', filterSnippets);
    
    // Preview/Edit toggle
    previewBtn.addEventListener('click', () => {
      previewBtn.classList.add('bg-gray-100');
      editBtn.classList.remove('bg-gray-100');
      codeEditor.classList.remove('hidden');
      previewArea.classList.add('hidden');
    });
    
    editBtn.addEventListener('click', () => {
      editBtn.classList.add('bg-gray-100');
      previewBtn.classList.remove('bg-gray-100');
      updatePreview();
      codeEditor.classList.add('hidden');
      previewArea.classList.remove('hidden');
    });
    
    // Update preview when code or language changes
    codeEditor.addEventListener('input', () => {
      if (!previewArea.classList.contains('hidden')) {
        updatePreview();
      }
    });
    
    languageSelect.addEventListener('change', () => {
      if (!previewArea.classList.contains('hidden')) {
        updatePreview();
      }
    });
    
    // Delete modal events
    cancelDeleteBtn.addEventListener('click', () => {
      deleteModal.classList.add('hidden');
      snippetToDelete = null;
    });
    
    confirmDeleteBtn.addEventListener('click', deleteSnippet);
    
    // Initialize app
    loadSnippets();
    renderSnippetList();
    renderTagFilters();
    newSnippet();
  </script>
</body>
</html>